<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RyanPhim - Outline Pro 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #ff5b00; --bg-main: #141414; }
        body { background-color: var(--bg-main); color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .movie-card:hover img { transform: scale(1.05); }
        .line-clamp-1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
        .bg-banner { background: linear-gradient(to top, #141414 5%, transparent 100%); }
    </style>
</head>
<body>

    <nav class="bg-black/90 sticky top-0 z-50 border-b border-white/5 backdrop-blur-md">
        <div class="container mx-auto px-4 flex items-center justify-between h-16">
            <div class="flex items-center gap-10">
                <h1 onclick="location.reload()" class="text-3xl font-black text-[#ff5b00] cursor-pointer italic">RYANPHIM</h1>
                <div class="hidden lg:flex gap-6 text-sm font-bold uppercase tracking-tighter">
                    <a href="javascript:void(0)" onclick="loadHome()" class="text-orange-500 border-b-2 border-orange-500 pb-1">Home</a>
                    <a href="javascript:void(0)" onclick="loadCat('phim-bo')" class="hover:text-orange-500">Phim Bộ</a>
                    <a href="javascript:void(0)" onclick="loadCat('phim-le')" class="hover:text-orange-500">Phim Lẻ</a>
                    <a href="javascript:void(0)" onclick="loadCat('hoat-hinh')" class="hover:text-orange-500">Hoạt Hình</a>
                </div>
            </div>
            <div class="flex items-center bg-[#222] px-4 py-1.5 rounded-full border border-white/10 w-80">
                <i class="fas fa-search text-gray-500 mr-2 text-xs"></i>
                <input id="searchInput" type="text" placeholder="Có nhiều điều đợi bạn khám phá..." class="bg-transparent border-none outline-none text-xs w-full text-gray-300">
            </div>
        </div>
    </nav>

    <div id="hero" class="relative h-[550px] w-full bg-black overflow-hidden">
        <div id="heroContent" class="h-full">
            </div>
        <div class="absolute inset-0 bg-banner"></div>
    </div>

    <main class="container mx-auto px-4 -mt-24 relative z-10">
        <div id="playerArea" class="hidden mb-12 animate-pulse-slow">
            <div class="bg-zinc-900 rounded-xl overflow-hidden shadow-2xl border border-white/5">
                <div class="aspect-video">
                    <iframe id="mainIframe" class="w-full h-full" src="" frameborder="0" allowfullscreen></iframe>
                </div>
                <div class="p-6">
                    <h2 id="playTitle" class="text-2xl font-bold text-orange-500 mb-4"></h2>
                    <div id="epList" class="flex flex-wrap gap-2"></div>
                </div>
            </div>
        </div>

        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold flex items-center gap-2 uppercase tracking-widest">
                <i class="fas fa-bolt text-orange-500"></i> Phim Đề Cử
            </h2>
            <button onclick="loadHome()" class="text-xs text-gray-500 hover:text-orange-500 italic"><i class="fas fa-sync"></i> Ngẫu nhiên</button>
        </div>

        <div id="movieGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-5">
            </div>
    </main>

    <footer class="py-16 mt-20 border-t border-white/5 text-center">
        <p class="text-gray-600 text-[10px] tracking-[0.2em] uppercase font-bold italic">© 2026 RYANPHIM - Thiết kế bởi Đặng Hoàng Thiện Nhân</p>
    </footer>

    <script>
        const API_V1 = 'https://ophim1.com/v1/api';
        const IMG_URL = 'https://phimimg.com/upload/poster/';

        async function init() {
            loadHome();
            document.getElementById('searchInput').onkeypress = (e) => { if(e.key === 'Enter') searchMovies(); };
        }

        // Tối ưu hóa việc lấy ảnh từ API Images bạn cung cấp
        async function getMovieImage(slug) {
            try {
                const res = await fetch(`${API_V1}/phim/${slug}/images`);
                const data = await res.json();
                // Ưu tiên lấy backdrop cho banner, nếu không có lấy poster
                return data.images?.backdrops?.[0]?.file_path || data.images?.posters?.[0]?.file_path || '';
            } catch { return ''; }
        }

        async function loadHome() {
            const res = await fetch(`${API_V1}/home`);
            const data = await res.json();
            const movies = data.data.items;

            // Render Banner (Lấy phim đầu tiên làm Banner lớn)
            const bannerPhim = movies[0];
            document.getElementById('heroContent').innerHTML = `
                <div class="relative h-full w-full flex items-end p-10 md:p-20">
                    <img src="${IMG_URL}${bannerPhim.thumb_url}" class="absolute inset-0 w-full h-full object-cover opacity-30 shadow-inner">
                    <div class="relative z-10 max-w-2xl">
                        <span class="bg-orange-600 text-[10px] px-2 py-1 rounded-sm font-bold uppercase mb-4 inline-block">Trending Now</span>
                        <h2 class="text-5xl md:text-7xl font-black mb-4 uppercase tracking-tighter">${bannerPhim.name}</h2>
                        <p class="text-gray-400 text-sm mb-6 line-clamp-2 italic">${bannerPhim.origin_name}</p>
                        <button onclick="playPhim('${bannerPhim.slug}')" class="bg-white text-black px-8 py-3 rounded-sm font-bold hover:bg-orange-600 hover:text-white transition uppercase text-sm tracking-widest">Xem ngay</button>
                    </div>
                </div>
            `;

            renderGrid(movies);
        }

        async function loadCat(slug) {
            const res = await fetch(`${API_V1}/danh-sach/${slug}`);
            const data = await res.json();
            document.getElementById('hero').classList.add('hidden');
            renderGrid(data.data.items);
        }

        async function searchMovies() {
            const kw = document.getElementById('searchInput').value;
            const res = await fetch(`${API_V1}/tim-kiem?keyword=${kw}`);
            const data = await res.json();
            renderGrid(data.data.items);
        }

        function renderGrid(movies) {
            const grid = document.getElementById('movieGrid');
            grid.innerHTML = movies.map(m => `
                <div onclick="playPhim('${m.slug}')" class="movie-card group cursor-pointer">
                    <div class="relative aspect-[2/3] rounded-sm overflow-hidden bg-zinc-800">
                        <img src="${IMG_URL}${m.thumb_url}" class="w-full h-full object-cover transition duration-700 group-hover:brightness-50" onerror="this.src='https://via.placeholder.com/300x450?text=RyanPhim'">
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-300">
                            <i class="fas fa-play text-3xl text-orange-500"></i>
                        </div>
                        <div class="absolute top-2 left-2 flex flex-col gap-1">
                            <span class="bg-sky-600 text-[9px] font-bold px-1.5 py-0.5 rounded-sm shadow-lg">${m.year || '2026'}</span>
                            <span class="bg-orange-600 text-[9px] font-bold px-1.5 py-0.5 rounded-sm shadow-lg">FHD</span>
                        </div>
                    </div>
                    <div class="mt-3">
                        <h3 class="text-sm font-bold line-clamp-1 group-hover:text-orange-500 transition uppercase tracking-tight">${m.name}</h3>
                        <p class="text-[10px] text-gray-500 truncate mt-1 italic">${m.origin_name}</p>
                    </div>
                </div>
            `).join('');
        }

        async function playPhim(slug) {
            const res = await fetch(`${API_V1}/phim/${slug}`);
            const data = await res.json();
            const phim = data.data.item;

            document.getElementById('playerArea').classList.remove('hidden');
            document.getElementById('playTitle').innerText = phim.name;
            
            const eps = document.getElementById('epList');
            eps.innerHTML = phim.episodes[0].server_data.map(ep => `
                <button onclick="document.getElementById('mainIframe').src='${ep.link_embed}'" class="bg-zinc-800 hover:bg-orange-600 px-4 py-1.5 text-xs font-bold transition rounded-sm border border-white/5 uppercase">
                    ${ep.name}
                </button>
            `).join('');
            
            document.getElementById('mainIframe').src = phim.episodes[0].server_data[0].link_embed;
            window.scrollTo({ top: 450, behavior: 'smooth' });
        }

        init();
    </script>
</body>
</html>